#!/bin/bash

# Olang linker wrapper script
# Use ld.lld to link object files into executable

if [ $# -lt 2 ]; then
    echo "Usage: $0 <output> <input.o> [input2.o ...] [library options]"
    echo "Example: $0 program main.o lib.o"
    echo "Example: $0 program main.o -lncurses"
    exit 1
fi

OUTPUT="$1"
shift
INPUTS="$@"

# Link using ld.lld
ld.lld \
    -dynamic-linker /lib64/ld-linux-x86-64.so.2 \
    /usr/lib/x86_64-linux-gnu/crt1.o \
    /usr/lib/x86_64-linux-gnu/crti.o \
    $INPUTS \
    -lc \
    -L/usr/lib/x86_64-linux-gnu \
    -L/lib/x86_64-linux-gnu \
    /usr/lib/x86_64-linux-gnu/crtn.o \
    -o "$OUTPUT"

if [ $? -eq 0 ]; then
    echo "✅ Linked: $OUTPUT"
    chmod +x "$OUTPUT"
else
    echo "❌ Link failed"
    exit 1
fi

